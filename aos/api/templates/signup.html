<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-OS | Community Onboarding</title>
    <!-- A-OS Design System -->
    {% include 'partials/design_system.html' %}
    <style>
        body {
            background: var(--aos-bg);
            background-image:
                radial-gradient(circle at 0% 0%, var(--aos-primary-base) 0%, transparent 25%),
                radial-gradient(circle at 100% 100%, var(--aos-success-base) 0%, transparent 25%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            padding: 2rem;
        }

        .signup-card {
            background: var(--aos-surface-glass);
            backdrop-filter: blur(20px);
            border: 1px solid white;
            border-color: rgba(255, 255, 255, 0.1);
            border-radius: var(--aos-radius-lg);
            padding: 2.5rem;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--aos-shadow-lg);
            animation: aos-fade-up 0.6s ease-out;
        }

        .toggle-group {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            padding: 4px;
            border-radius: var(--aos-radius-md);
            margin-bottom: 2rem;
        }

        .toggle-btn {
            flex: 1;
            padding: 0.75rem;
            text-align: center;
            border-radius: calc(var(--aos-radius-md) - 2px);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--aos-text-muted);
        }

        .toggle-btn.active {
            background: var(--aos-primary-base);
            color: white;
            box-shadow: 0 4px 12px rgba(56, 189, 248, 0.3);
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>
    <div class="signup-card">
        <div class="text-center mb-8">
            <div
                class="aos-h1 text-transparent bg-clip-text bg-gradient-to-r from-[var(--aos-primary-base)] to-[var(--aos-primary-light)] mb-2">
                A-OS Kernel</div>
            <div class="aos-text-sm aos-text-muted">Initialize your local community network</div>
        </div>

        <div class="toggle-group">
            <div id="btnJoin" class="toggle-btn active" onclick="setMode('join')">Join Existing</div>
            <div id="btnCreate" class="toggle-btn" onclick="setMode('create')">Start New</div>
        </div>

        <form action="/auth/signup" method="POST" id="signupForm">
            <!-- New Community Toggle Field -->
            <input type="hidden" name="create_new" id="createNewField" value="false">

            <div class="form-group mb-4">
                <label
                    class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Username</label>
                <input type="text" name="username" class="aos-input w-full" placeholder="e.g. admin_kenya" required
                    autofocus shadow>
            </div>

            <div class="form-group mb-6">
                <label
                    class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Password</label>
                <input type="password" name="password" class="aos-input w-full" placeholder="••••••••" required shadow>
            </div>

            <!-- MODE: JOIN EXISTING -->
            <div id="joinFields">
                <div class="form-group mb-8">
                    <label class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Select
                        Community</label>
                    <select name="community_id" id="join_community_id" class="aos-input w-full" required shadow>
                        <option value="" disabled selected>Choose your group...</option>
                        {% for comm in communities %}
                        <option value="{{ comm.id }}">{{ comm.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <!-- MODE: START NEW -->
            <div id="createFields" class="hidden">
                <div class="form-group mb-4">
                    <label
                        class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Community
                        Name</label>
                    <input type="text" name="community_name" id="new_community_name" class="aos-input w-full"
                        placeholder="e.g. Nairobi Central Mosque" shadow>
                </div>

                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="form-group">
                        <label
                            class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Type</label>
                        <select name="community_type" class="aos-input w-full" shadow>
                            <option value="faith">Faith/Religion</option>
                            <option value="group">Community Group</option>
                            <option value="sacco">Fin/Sacco</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label
                            class="aos-text-xs aos-text-muted mb-2 block font-semibold uppercase tracking-wider">Location</label>
                        <input type="text" name="location" class="aos-input w-full" placeholder="e.g. Nairobi" shadow>
                    </div>
                </div>
            </div>

            <button type="submit" class="aos-btn aos-btn-primary w-full aos-size-md group relative overflow-hidden">
                <div
                    class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-700">
                </div>
                <span class="aos-btn-text">Initialize Account</span>
            </button>
        </form>

        <div class="text-center mt-8 aos-text-sm aos-text-muted">
            Already have an account? <a href="/login"
                class="text-[var(--aos-primary-base)] font-bold hover:underline">Sign In</a>
        </div>
    </div>

    <script>
        function setMode(mode) {
            const btnJoin = document.getElementById('btnJoin');
            const btnCreate = document.getElementById('btnCreate');
            const joinFields = document.getElementById('joinFields');
            const createFields = document.getElementById('createFields');
            const createNewField = document.getElementById('createNewField');

            const joinSelect = document.getElementById('join_community_id');
            const createNameInput = document.getElementById('new_community_name');

            if (mode === 'join') {
                btnJoin.classList.add('active');
                btnCreate.classList.remove('active');
                joinFields.classList.remove('hidden');
                createFields.classList.add('hidden');
                createNewField.value = "false";

                joinSelect.required = true;
                createNameInput.required = false;
            } else {
                btnJoin.classList.remove('active');
                btnCreate.classList.add('active');
                joinFields.classList.add('hidden');
                createFields.classList.remove('hidden');
                createNewField.value = "true";

                joinSelect.required = false;
                createNameInput.required = true;
            }
        }
    </script>
</body>

</html>