{# CollapsibleMenuGroup Molecule - FAANG-Grade Component #}
{% macro collapsible_menu_group(
title,
icon,
items,
group_id,
is_expanded=False
) %}
<div class="collapsible-group" data-group-id="{{ group_id }}">
    <!-- Group Header -->
    <button
        class="group-header w-full flex items-center justify-between px-3 py-2 aos-text-sm font-semibold text-[var(--aos-neutral-300)] hover:bg-[var(--aos-surface-accent)] rounded-[var(--aos-radius-lg)] transition-all duration-200 {% if is_expanded %}expanded{% endif %}"
        onclick="toggleGroup('{{ group_id }}')" aria-expanded="{{ 'true' if is_expanded else 'false' }}"
        aria-controls="group-content-{{ group_id }}">
        <div class="flex items-center space-x-3">
            <div class="w-5 h-5 aos-text-muted group-hover:text-[var(--aos-primary-base)] transition-colors">
                {{ icon | safe }}
            </div>
            <span>{{ title }}</span>
        </div>
        <svg class="chevron w-4 h-4 text-[var(--aos-neutral-500)] transition-transform duration-200 {% if is_expanded %}rotate-90{% endif %}"
            fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
    </button>

    <!-- Group Content -->
    <div id="group-content-{{ group_id }}"
        class="group-content overflow-hidden transition-all duration-300 {% if is_expanded %}max-h-screen{% else %}max-h-0{% endif %}">
        <div class="pl-4 pr-3 py-1 space-y-1">
            {% for item in items %}
            {% if item.section %}
            <div
                class="pt-3 pb-1 aos-text-[9px] font-black uppercase tracking-[0.2em] text-[var(--aos-neutral-500)] pl-4">
                {{ item.section }}
            </div>
            {% endif %}

            {% if item.submenu %}
            {# Recursive call for nested groups #}
            <div class="mt-2 pl-2">
                {{ collapsible_menu_group(
                title=item.text,
                icon=item.icon,
                items=item.submenu,
                group_id=group_id ~ '-' ~ (item.text | lower | replace(' ', '-')),
                is_expanded=item.active
                ) }}
            </div>
            {% else %}
            <a href="{{ item.href }}" data-nav-item data-search-text="{{ item.text | lower }}"
                class="flex items-center space-x-3 px-3 py-2 aos-text-sm text-[var(--aos-neutral-400)] hover:text-[var(--aos-neutral-200)] hover:bg-[var(--aos-surface-glass)] rounded-[var(--aos-radius-lg)] transition-all duration-150 group {% if item.active %}active-nav-item{% endif %}">
                <div
                    class="w-4 h-4 text-[var(--aos-neutral-500)] group-hover:text-[var(--aos-primary-base)] transition-colors">
                    {{ item.icon | safe }}
                </div>
                <span class="truncate">{{ item.text }}</span>
                {% if item.badge %}
                <span
                    class="ml-auto px-1.5 py-0.5 aos-text-[9px] font-bold rounded-full bg-[var(--aos-primary-base)]/20 text-[var(--aos-primary-base)] border border-[var(--aos-primary-base)]/30">
                    {{ item.badge }}
                </span>
                {% endif %}
            </a>
            {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

{% endmacro %}