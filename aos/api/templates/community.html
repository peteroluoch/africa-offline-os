{% extends "dashboard.html" %}
{% from "components/atoms/EliteButton.html" import elite_button %}
{% from "components/atoms/Card.html" import card %}
{% from "components/molecules/DataCard.html" import data_card %}

{% block content %}
<header class="mb-10">
    <h1 class="aos-h1 mb-2">Community-Pulse</h1>
    <p class="aos-text-muted aos-text-sm">trusted social distribution networks</p>
</header>

<!-- Metrics Row -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
    {{ data_card(label="Active Groups", value=groups|length|string, status="info") }}
    {{ data_card(label="Broadcasts", value=broadcasts_count|default(0)|string, unit="30d", status="success") }}
    {{ data_card(label="Inquiry Hits", value=inquiry_hits|default(0)|string, status="warning") }}
</div>

<section class="aos-stack-md">
    <div class="flex items-center justify-between mb-6">
        <h2 class="aos-h2">Registered Groups</h2>
        <button class="aos-btn aos-btn-primary aos-size-md" hx-get="/community/register" hx-target="#modal-content"
            onclick="openModal()">
            <span class="aos-btn-text">Register Group</span>
        </button>
    </div>

    {% call card(padding="0", class="aos-overflow-hidden") %}
    <table class="aos-table">
        <thead>
            <tr>
                <th>Group Name</th>
                <th>Type</th>
                <th>Trust Level</th>
                <th>Created</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for group in groups %}
            <tr>
                <td class="aos-font-bold">{{ group.name }}</td>
                <td><span class="aos-badge aos-badge-info">{{ group.group_type }}</span></td>
                <td>
                    <span
                        class="aos-badge {% if group.trust_level == 'verified' %}aos-badge-success{% else %}aos-badge-warning{% endif %}">
                        {{ group.trust_level }}
                    </span>
                </td>
                <td class="aos-text-sm aos-text-muted">{{ group.created_at.strftime('%Y-%m-%d') }}</td>
                <td>
                    <div class="flex items-center gap-2">
                        <button class="aos-btn aos-btn-ghost aos-size-sm">
                            <span class="aos-btn-text">View</span>
                        </button>
                        <button class="aos-btn aos-btn-ghost aos-size-sm aos-text-danger">
                            <span class="aos-btn-text">Review</span>
                        </button>
                    </div>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="aos-text-center aos-py-8 aos-text-muted">
                    No community groups registered on this node.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endcall %}
</section>

<!-- Modal container for registration form -->
<div id="modal-container" class="aos-modal-overlay hidden">
    {% call card(padding="6", glass=True, id="modal-content", class="aos-modal-content aos-stack-md") %}
    <!-- Loaded via HTMX -->
    {% endcall %}
</div>

<script>
    function openModal() {
        document.getElementById('modal-container').classList.remove('hidden');
    }
    function closeModal() {
        document.getElementById('modal-container').classList.add('hidden');
    }
</script>
{% endblock %}