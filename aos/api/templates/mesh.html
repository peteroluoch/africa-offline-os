{% extends "dashboard.html" %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
    <!-- Peer Registration Form -->
    <div class="lg:col-span-1 space-y-8">
        {% call card() %}
        <h3 class="aos-text-display text-lg font-bold text-white mb-6">Register Peer Node</h3>
        <form hx-post="/sys/mesh/register" hx-target="#mesh-list" hx-swap="beforeend" class="space-y-6">
            {{ form_field(label="Node ID", name="node_id", placeholder="remote-node-01", required=True) }}
            {{ form_field(label="Base URL", name="base_url", placeholder="http://192.168.1.50:8000",
            required=True) }}
            {{ form_field(label="Public Key (Hex)", name="public_key", placeholder="ed25519_pub_key...",
            required=True) }}
            <div class="pt-4">
                {{ elite_button(text="Add Peer to Mesh", type="submit", class="w-full", variant="primary") }}
            </div>
        </form>
        {% endcall %}
    </div>

    <!-- Active Peers List -->
    <div class="lg:col-span-2">
        {% call card(padding="0", class="flex flex-col min-h-[400px] overflow-hidden") %}
        <div class="p-6 border-b border-white/5 flex items-center justify-between bg-white/[0.02]">
            <h3 class="aos-text-display text-lg font-bold text-white">Known Peers</h3>
            {{ badge(text="Active Nodes: " ~ peers|length, variant="success") }}
        </div>
        <div id="mesh-list" class="flex-1 p-6 space-y-4">
            {% if peers %}
            {% for peer in peers %}
            {% include "partials/node_card.html" with peer=peer %}
            {% endfor %}
            {% else %}
            <div class="text-center py-20 text-slate-500 aos-text-mono text-sm opacity-50">
                No remote nodes registered in this mesh link.
            </div>
            {% endif %}
        </div>
        {% endcall %}
    </div>
</div>
{% endblock %}