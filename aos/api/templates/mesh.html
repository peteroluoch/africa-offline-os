{% from "components/atoms/EliteButton.html" import elite_button %}
{% from "components/atoms/Badge.html" import badge %}
{% from "components/atoms/Card.html" import card %}
{% from "components/molecules/FormField.html" import form_field %}
{% from "components/molecules/SidebarItem.html" import sidebar_item %}
{% from "components/molecules/NodeStatus.html" import node_status %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A-OS Kernel | Mesh Management</title>

    <!-- A-OS Design System -->
    {% include 'partials/design_system.html' %}

    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        .mesh-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, #1e293b 0%, #0f172a 100%);
            z-index: -1;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="min-h-screen flex overflow-hidden">
    <div class="mesh-bg"></div>

    <!-- Sidebar -->
    <aside class="w-72 border-r border-slate-800/50 aos-glass p-6 flex flex-col hidden lg:flex relative z-10">
        <div class="mb-10 px-2 text-center">
            <h1 class="aos-text-display text-4xl font-extrabold tracking-tighter text-blue-400">A-OS</h1>
            <p class="text-slate-500 text-[10px] uppercase tracking-[0.3em] font-bold aos-text-mono mt-1">Kernel v0.1.0
            </p>
        </div>

        <nav class="flex-1 space-y-2">
            {{ sidebar_item(text="Real-time Stream", href="/dashboard", icon='<svg class="w-5 h-5" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                </path>
            </svg>') }}
            {{ sidebar_item(text="Mesh Nodes", active=True, icon='<svg class="w-5 h-5" fill="none" stroke="currentColor"
                viewBox="0 0 24 24">
                <path
                    d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>') }}
        </nav>

        <div class="mt-auto">
            {{ node_status(name="Mesh Health", status="warning", status_text="SOVEREIGN") }}
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden relative z-10">
        <header class="h-20 border-b border-slate-800/50 aos-glass px-10 flex items-center justify-between">
            <div class="flex items-center space-x-6">
                <h2 class="aos-text-display text-xl font-bold text-slate-200 tracking-tight">Mesh Management</h2>
                <div class="h-5 w-px bg-slate-800"></div>
                {{ badge(text="P2P-Identity-Verified", variant="info") }}
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-10 space-y-10">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Peer Registration Form -->
                <div class="lg:col-span-1 space-y-8">
                    {% call card() %}
                    <h3 class="aos-text-display text-lg font-bold text-white mb-6">Register Peer Node</h3>
                    <form hx-post="/sys/mesh/register" hx-target="#mesh-list" hx-swap="beforeend" class="space-y-6">
                        {{ form_field(label="Node ID", name="node_id", placeholder="remote-node-01", required=True) }}
                        {{ form_field(label="Base URL", name="base_url", placeholder="http://192.168.1.50:8000",
                        required=True) }}
                        {{ form_field(label="Public Key (Hex)", name="public_key", placeholder="ed25519_pub_key...",
                        required=True) }}
                        <div class="pt-4">
                            {{ elite_button(text="Add Peer to Mesh", type="submit", class="w-full", variant="primary")
                            }}
                        </div>
                    </form>
                    {% endcall %}
                </div>

                <!-- Active Peers List -->
                <div class="lg:col-span-2">
                    {% call card(padding="0", class="flex flex-col min-h-[400px] overflow-hidden") %}
                    <div class="p-6 border-b border-white/5 flex items-center justify-between bg-white/[0.02]">
                        <h3 class="aos-text-display text-lg font-bold text-white">Known Peers</h3>
                        {{ badge(text="Active Nodes: 0", variant="success") }}
                    </div>
                    <div id="mesh-list" class="flex-1 p-6 space-y-4">
                        <!-- Peers will be rendered here -->
                        <div class="text-center py-20 text-slate-500 aos-text-mono text-sm opacity-50">
                            No remote nodes registered in this mesh link.
                        </div>
                    </div>
                    {% endcall %}
                </div>
            </div>
        </div>
    </main>
</body>

</html>